<?php
include($_SERVER['DOCUMENT_ROOT'].'/btslab/lib/loginverify.php');
 include($_SERVER['DOCUMENT_ROOT'].'/btslab/header.php');  

if(!isset($_POST['change']))
{
		$_SESSION['csrf']=md5(rand());

?>
 CSRF Token is Enabled in this page:</br></br>
		Enter the New Email:<br/><br/>
		<form action="change-email.php" method="POST">
		New Email ID: <input type="text" name="email" value=""/>
		<input type="hidden" name="csrf" value="<?php echo $_SESSION['csrf'];?>"/>
		<input type="hidden" name="id" value="<?php echo $_SESSION['userid'];?>"/>
		<br/><br/><input type="submit" name="change" value="Change"/>
		
		</form>
		<br/>
		<?php 
}	
		
		if(isset($_POST['csrf'])&&(strcmp($_POST['csrf'],$_SESSION['csrf'])==0)&&isset($_POST['email'])&&!empty($_POST['email']))
		{
			$email=$_POST['email'];
			$id=$_POST['id'];
			include($_SERVER['DOCUMENT_ROOT'].'/btslab/mysqlconnection.php');
			$result=mysql_query("Update users set email='$email' where id='$id' ");
			echo "<b style='color:red'>email Changed</b>";
			echo "<br/><br/><b><a href='change-email.php'>Return to the Previous page </a></b>";
		}				 
		
echo "<br/><br/><a href='/btslab/myprofile.php?id=".$_SESSION['userid']."'>Return to Profile Page &gt;&gt;</a>";		
		include($_SERVER['DOCUMENT_ROOT'].'/btslab/footer.php'); ?>
<!-- CSRF 2 -->
<!-- Insecure Direct Object Reference 2 -->
